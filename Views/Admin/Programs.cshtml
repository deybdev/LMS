@{
    ViewBag.Title = "Programs";
}
@model IEnumerable<LMS.Models.Program>

<link rel="stylesheet" href="~/Content/manageUser.css" />
<link rel="stylesheet" href="~/Content/adminAcademic.css" />


<div class="admin-container">
    <div class="page-header">
        <h1>Program Management</h1>
        <p class="subtitle">Manage academic programs, year levels, and sections</p>
    </div>

    <!-- Create Program Button -->
    <div class="create-dropdown mb-3">
        <button type="button" data-bs-toggle="modal" data-bs-target="#createProgramModal">
            <i class="fa-solid fa-plus"></i> Create Program
        </button>
    </div>

    <!-- Navigation Tabs -->
    <div class="admin-navigation">
        <div class="nav-tabs">
            <button class="nav-tab"
                    onclick="window.location.href='@Url.Action("Departments", "Admin")'">
                Department
            </button>
            <button class="nav-tab active"
                    onclick="window.location.href='@Url.Action("Programs", "Admin")'">
                Program
            </button>
            <button class="nav-tab"
                    onclick="window.location.href='@Url.Action("Sections", "Admin")'">
                Sections
            </button>
        </div>
    </div>


    <!-- Main Content -->
    <div class="admin-content">
        <!-- Search and Filter Section -->
        <div class="search-filter-section">
            <div class="filter-controls">
                <input type="text" id="searchInput" class="search-input" placeholder="Search programs by name, code, or department..." />

                <div class="filter-dropdowns">
                    <select class="filter-select" id="departmentFilter">
                        <option value="">All Departments</option>
                        <option value="Computer Studies">Computer Studies</option>
                        <option value="Information Technology">Information Technology</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Business Administration">Business Administration</option>
                        <option value="Accountancy">Accountancy</option>
                        <option value="Education">Education</option>
                        <option value="General Education">General Education</option>
                    </select>

                    <select class="filter-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Programs Table -->
        <div class="default-table-container">
            <table class="default-table">
                <thead>
                    <tr>
                        <th>Program Name</th>
                        <th>Code</th>
                        <th>Department</th>
                        <th>Duration</th>
                        <th>Date Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="programTableBody" data-delete-url="@Url.Action("Delete", "Program")">

                    @foreach (var p in Model)
                    {
                        <tr class="default-row"
                            data-department="@p.Department.DepartmentCode"
                            data-status="Active">

                            <td class="default-info">
                                @{
                                    string program = p.ProgramName?.Trim() ?? "";
                                    string shortProgram = program;

                                    if (!string.IsNullOrEmpty(program))
                                    {
                                        var words = program.Split(' ');
                                        var skipWords = new[] { "of" };
                                        int end = words.Length;

                                        for (int i = 0; i < words.Length; i++)
                                        {
                                            if (words[i].Equals("in", StringComparison.OrdinalIgnoreCase) ||
                                                words[i].Equals("major", StringComparison.OrdinalIgnoreCase))
                                            {
                                                end = i;
                                                break;
                                            }
                                        }

                                        string acronym = string.Concat(
                                            words.Take(end)
                                                 .Where(w => !skipWords.Contains(w, StringComparer.OrdinalIgnoreCase))
                                                 .Select(w => char.ToUpper(w[0]))
                                        );

                                        string remaining = string.Join(" ", words.Skip(end));

                                        shortProgram = $"{acronym} {remaining}".Trim();
                                    }
                                }

                                <div class="user-name">@shortProgram</div>
                            </td>

                            <td><span class="role-tag">@p.ProgramCode</span></td>

                            <td>@p.Department.DepartmentCode</td>

                            <td>@p.ProgramDuration Years</td>

                            <td class="last-login">
                                <div>@p.DateCreated.ToString("MM/dd/yyyy")</div>
                                <div class="login-time">@p.DateCreated.ToString("hh:mm tt")</div>
                            </td>

                            <td class="action-buttons">
                                <button class="action-btn edit-btn" data-id="@p.Id" title="Edit">
                                    <i class="fa-solid fa-pen"></i>
                                </button>

                                <button type="button" class="action-btn delete-btn"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteModal"
                                        data-item-id="@p.Id"
                                        data-item-name="@p.ProgramCode"
                                        data-target-remove=".default-row"
                                        data-url="@Url.Action("Delete", "Program")"
                                        title="Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </td>

                        </tr>
                    }

                </tbody>
            </table>
        </div>

        <!-- Pagination Controls -->
        <div class="pagination-container">
            <div class="pagination-info">
                <span id="paginationInfo">Showing 1-5 of 5 entries</span>
                <span id="currentPageInfo" class="ms-3">Page 1 of 1</span>
            </div>
            <div class="pagination-controls">
                <button class="pagination-btn" id="prevBtn" disabled>
                    <i class="fa-solid fa-chevron-left"></i> Previous
                </button>
                <div class="pagination-numbers" id="paginationNumbers">
                    <button class="pagination-number active">1</button>
                </div>
                <button class="pagination-btn" id="nextBtn" disabled>
                    Next <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</div>


<div id="alertContainer" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; max-width: 320px;"></div>

<!-- Create/Edit Program Modal -->
<div class="modal fade" id="createProgramModal" tabindex="-1" aria-labelledby="createProgramModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createProgramModalLabel">
                    <i class="fa-solid fa-graduation-cap"></i> <span id="modalTitle">Create New Program</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div id="formErrorContainer" class="alert alert-danger alert-dismissible fade show d-none" role="alert">
                    <i class="fa-solid fa-circle-exclamation me-2"></i>
                    <span id="formErrorMessage"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>

                <form id="createProgramForm">
                    @Html.AntiForgeryToken()

                    <input type="hidden" id="programId" name="Id" />

                    <div class="mb-3">
                        <label for="programName" class="form-label">Program Name *</label>
                        <input type="text" id="programName" name="ProgramName" class="form-control" required placeholder="e.g., Bachelor of Science in Computer Science">
                    </div>

                    <div class="mb-3">
                        <label for="programCode" class="form-label">Program Code *</label>
                        <input type="text" id="programCode" name="ProgramCode" class="form-control" required placeholder="e.g., BSCS">
                    </div>

                    <div class="mb-3">
                        <label for="department" class="form-label">Department *</label>
                        <select id="department" name="DepartmentId" class="form-select" required>
                            <option value="">Choose department</option>

                            @foreach (var d in ViewBag.Departments)
                            {
                                <option value="@d.Id">@d.DepartmentName</option>
                            }
                        </select>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="programDuration" class="form-label">Duration (Years) *</label>
                            <input type="number" id="programDuration" name="ProgramDuration" class="form-control" required min="1" max="10" placeholder="4">
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn cancel-btn" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" id="submitProgramBtn" form="createProgramForm">
                    <i id="programIcon" class="fa-solid fa-save me-1"></i> <span id="btnText">Create</span>
                </button>
            </div>
        </div>
    </div>
</div>
<!-- Create/Edit Section Modal -->

@section scripts {
    <script src="~/Scripts/Custom/deleteHandler.js"></script>
    <script src="~/Scripts/Admin/formValidation.js"></script>

    @if (TempData["SuccessMessage"] != null)
    {
        <script>
            $(function () {
                showAlert('success', '@TempData["SuccessMessage"]');
            });
        </script>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <script>
            $(function () {
                showAlert('danger', '@TempData["ErrorMessage"]');
            });
        </script>
    }
}

