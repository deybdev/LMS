@{
    ViewData["Title"] = "Reset Password";
}

<div class="login-page">
    <!--RESET PASSWORD CONTAINER-->
    <div class="login-container text-center">
        <img src="/images/logo.png" alt="" />
        <h1>School LMS</h1>
        <p>
            Enter your email, reset code, and new password
        </p>

        <form method="post" action="@Url.Action("ResetPassword", "Account")" onsubmit="showLoading()">
            @if (ViewBag.Error != null)
            {
                <div class="alert alert-danger small p-2 mt-3 mb-1">@ViewBag.Error</div>
            }
            
            @if (ViewBag.Success != null)
            {
                <div class="alert alert-success small p-2 mt-3 mb-1">@ViewBag.Success</div>
            }

            <label class="w-100 mt-2 text-start">
                Email Address
                <input type="email" name="email" class="form-control mb-3 mt-2" required />
            </label>

            <label class="w-100 text-start">
                Reset Code
                <input type="text" name="resetCode" class="form-control mb-3 mt-2" placeholder="Enter 6-digit code from email" maxlength="6" required />
            </label>

            <label class="w-100 text-start position-relative">
                New Password
                <input type="password" name="newPassword" id="newPasswordInput" class="form-control mt-2 mb-3" required />
                <span id="toggleNewPassword" class="show-password-icon">
                    <i class="fa fa-eye"></i>
                </span>
            </label>

            <label class="w-100 text-start position-relative">
                Confirm New Password
                <input type="password" name="confirmPassword" id="confirmPasswordInput" class="form-control mt-2" required />
                <span id="toggleConfirmPassword" class="show-password-icon-confirm">
                    <i class="fa fa-eye"></i>
                </span>
            </label>

            <!-- Reset Password Button with built-in spinner -->
            <button type="submit" id="resetBtn" class="login-form-btn w-100 d-flex justify-content-center align-items-center mt-3" style="gap:8px;">
                <div id="resetSpinner" class="spinner-border spinner-border-xs text-light" role="status" style="display:none;"></div>
                <span id="resetText">Reset Password</span>
            </button>
        </form>

        <div class="mt-3">
            <a href="@Url.Action("Login", "Home")" class="d-block">Back to Login</a>
            <a href="@Url.Action("ForgotPassword", "Account")" class="d-block mt-2">Need a new reset code?</a>
        </div>
    </div>
</div>

<style>
    .spinner-border {
        width: 1.5rem;
        height: 1.5rem;
    }
    
    /* MEDIA QUERIES FOR MOBILE */
    @@media (max-width: 767.98px) {
        .login-container {
            padding: 1.5rem 1.5rem;
            margin-bottom: 100px;
        }

        .login-container h1{
            font-size: 1.3rem;
        }

        .login-container p{
            font-size: .8rem;
        }

        .login-form-btn{
            font-size: .95rem;
            padding: .65rem .2rem;
        }

        .login-container img {
            width: 70px;
        }
    }

    .show-password-icon {
        position: absolute;
        top: 73%;
        right: 15px;
        transform: translateY(-50%);
        cursor: pointer;
        color: #777;
        font-size: 1rem;
    }

    .show-password-icon-confirm {
        position: absolute;
        top: 73%;
        right: 15px;
        transform: translateY(-50%);
        cursor: pointer;
        color: #777;
        font-size: 1rem;
    }

    .show-password-icon:hover,
    .show-password-icon-confirm:hover {
        color: var(--dark-primary-color);
    }

    @@media (max-width: 575.98px) {
        .login-container {
            padding: 1rem 1rem;
            max-width: 90%;
        }

        .login-container h1{
            font-size: 1.2rem;
        }

        .login-container p{
            font-size: .75rem;
        }

        .login-container img {
            width: 60px;
        }
    }
</style>

<script>
    // Toggle password visibility for new password
    const toggleNewPassword = document.getElementById('toggleNewPassword');
    const newPasswordInput = document.getElementById('newPasswordInput');

    toggleNewPassword.addEventListener('click', function () {
        const type = newPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        newPasswordInput.setAttribute('type', type);
        this.innerHTML = type === 'password' ? '<i class="fa fa-eye"></i>' : '<i class="fa fa-eye-slash"></i>';
    });

    // Toggle password visibility for confirm password
    const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
    const confirmPasswordInput = document.getElementById('confirmPasswordInput');

    toggleConfirmPassword.addEventListener('click', function () {
        const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        confirmPasswordInput.setAttribute('type', type);
        this.innerHTML = type === 'password' ? '<i class="fa fa-eye"></i>' : '<i class="fa fa-eye-slash"></i>';
    });

    function showLoading() {
        const resetBtn = document.getElementById('resetBtn');
        const resetText = document.getElementById('resetText');
        const spinner = document.getElementById('resetSpinner');
        resetBtn.disabled = true;
        resetText.style.display = 'none';
        spinner.style.display = 'inline-block';
    }

    // Format reset code input (only numbers)
    const resetCodeInput = document.querySelector('input[name="resetCode"]');
    resetCodeInput.addEventListener('input', function(e) {
        // Remove any non-digit characters
        this.value = this.value.replace(/\D/g, '');
        
        // Limit to 6 digits
        if (this.value.length > 6) {
            this.value = this.value.slice(0, 6);
        }
    });
</script>