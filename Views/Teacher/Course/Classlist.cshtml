@model LMS.Models.Course

@{
    ViewBag.Title = "Classlist";
    int courseId = ViewBag.CourseId ?? Model.Id;
    ViewBag.ActiveTab = "ClassList";
    string defaultAttendanceDate = DateTime.Today.ToString("yyyy-MM-dd");
}

<link rel="stylesheet" href="~/Content/Site.css" />
<link rel="stylesheet" href="~/Content/teacherViewCourse.css" />
<link rel="stylesheet" href="~/Content/teacherClasslist.css" />

<div class="admin-container">
    @Html.Partial("_BackButton")
    @Html.Partial("_CourseHeader", Model)
    @Html.Partial("_CourseNavigation", Model)

    <div class="tab-content">
        <div class="tab-pane active">
            <!-- Class List Header -->
            <div class="classlist-header">
                <div class="header-actions">
                    <h2><i class="fas fa-users"></i> Class List</h2>
                </div>
                <div class="view-selector">
                    <label for="viewDropdown">View:</label>
                    <select id="viewDropdown" class="view-dropdown">
                        <option value="student-info">Student Information</option>
                        <option value="attendance">Take Attendance</option>
                        <option value="performance">Performance Overview</option>
                    </select>
                </div>
            </div>

            <!-- Student Information View -->
            <div id="studentInfoView" class="view-container active-view">
                <div class="classlist-container">
                    <div class="table-responsive">
                        <table class="classlist-table">
                            <thead>
                                <tr>
                                    <th>Student ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Grade</th>
                                </tr>
                            </thead>
                            <tbody id="studentTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Take Attendance View -->
            <div id="attendanceView" class="view-container">
                <div class="classlist-container">
                    <div class="date-selector">
                        <label for="attendanceDate">Date:</label>
                        <input type="date" id="attendanceDate" class="form-control" value="@defaultAttendanceDate">
                    </div>
                    <div class="attendance-info">
                        <div class="attendance-summary">
                            <span class="summary-item"><strong>Total Students:</strong> <span id="totalStudents">0</span></span>
                            <span class="summary-item"><strong>Present:</strong> <span id="presentCount">0</span></span>
                            <span class="summary-item"><strong>Late:</strong> <span id="lateCount">0</span></span>
                            <span class="summary-item"><strong>Absent:</strong> <span id="absentCount">0</span></span>
                            <span class="summary-item"><strong>Unmarked:</strong> <span id="unmarkedCount">0</span></span>
                        </div>
                        <div class="attendance-actions">
                            <button class="export-attendance"><i class="fas fa-save"></i>Export to CSV</button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="classlist-table">
                            <thead>
                                <tr>
                                    <th>No.</th>
                                    <th>Student Number</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Attendance Status</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <tr>
                                    <td colspan="5" class="loading-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p style="margin-top: 1rem;">Preparing attendance list...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Performance Overview View -->
            <div id="performanceView" class="view-container">
                <div class="classlist-container">
                    <div class="table-responsive">
                        <table class="classlist-table performance-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>
                                        Assignment 1
                                        <div class="max-points">/50</div>
                                    </th>
                                    <th>
                                        Quiz 1
                                        <div class="max-points">/20</div>
                                    </th>
                                    <th>
                                        Activity 1
                                        <div class="max-points">/30</div>
                                    </th>
                                    <th>
                                        Activity 2
                                        <div class="max-points">/30</div>
                                    </th>
                                    <th>
                                        Midterm Exam
                                        <div class="max-points">/100</div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="performanceTableBody">
                                <!-- Sample data -->
                                <tr>
                                    <td><span class="student-name">Alice Johnson</span></td>
                                    <td><span class="grade-score editable-grade" data-original="45" data-max="50" data-student-id="1" data-assignment="Assignment 1">45</span></td>
                                    <td><span class="grade-score editable-grade" data-original="18" data-max="20" data-student-id="1" data-assignment="Quiz 1">18</span></td>
                                    <td><span class="grade-score editable-grade" data-original="28" data-max="30" data-student-id="1" data-assignment="Activity 1">28</span></td>
                                    <td><span class="grade-score editable-grade" data-original="29" data-max="30" data-student-id="1" data-assignment="Activity 2">29</span></td>
                                    <td><span class="grade-score editable-grade" data-original="95" data-max="100" data-student-id="1" data-assignment="Midterm Exam">95</span></td>
                                </tr>
                                <tr>
                                    <td><span class="student-name">Bob Smith</span></td>
                                    <td><span class="grade-score editable-grade" data-original="42" data-max="50" data-student-id="2" data-assignment="Assignment 1">42</span></td>
                                    <td><span class="grade-score editable-grade" data-original="16" data-max="20" data-student-id="2" data-assignment="Quiz 1">16</span></td>
                                    <td><span class="grade-score editable-grade" data-original="25" data-max="30" data-student-id="2" data-assignment="Activity 1">25</span></td>
                                    <td><span class="grade-score editable-grade" data-original="27" data-max="30" data-student-id="2" data-assignment="Activity 2">27</span></td>
                                    <td><span class="grade-score editable-grade" data-original="88" data-max="100" data-student-id="2" data-assignment="Midterm Exam">88</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        var teacherCourseSectionId = @(ViewBag.TeacherCourseSectionId ?? 0);
        var courseId = @courseId;
    </script>
    <script src="~/Scripts/Custom/classlist.js"></script>
}

<!-- Late Minutes Modal -->
<div id="lateModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Mark Student as Late</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <p>How many minutes late is <strong id="lateStudentName"></strong>?</p>
            <div class="input-group">
                <input type="number" id="lateMinutesInput" class="form-control" min="0" placeholder="Enter minutes" />
                <span class="input-suffix">minutes</span>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel">Cancel</button>
            <button class="btn-confirm">Confirm</button>
        </div>
    </div>
</div>

<!-- Export Confirmation Modal -->
<div id="exportModal" class="modal">
    <div class="modal-content modal-export">
        <div class="modal-header">
            <h3><i class="fas fa-file-download"></i> Export Attendance</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <p style="margin: 0; font-size: 1rem; color: var(--dark-primary-color);">
                Are you sure you want to download attendance record on <strong id="exportDate" style="color: var(--primary-color);"></strong>?
            </p>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" id="exportCancel">Cancel</button>
            <button class="btn-confirm" id="exportConfirm">
                <i class="fas fa-download"></i> Download CSV
            </button>
        </div>
    </div>
</div>