@model LMS.Models.Course

@{
    ViewBag.Title = "Classlist";
    int courseId = ViewBag.CourseId ?? Model.Id;
    ViewBag.ActiveTab = "ClassList";
    string defaultAttendanceDate = DateTime.Today.ToString("yyyy-MM-dd");
}

<link rel="stylesheet" href="~/Content/Site.css" />
<link rel="stylesheet" href="~/Content/teacherViewCourse.css" />
<link rel="stylesheet" href="~/Content/teacherClasslist.css" />

<div class="admin-container">
    @Html.Partial("_BackButton")
    @Html.Partial("_CourseHeader", Model)
    @Html.Partial("_CourseNavigation", Model)

    <div class="tab-content">
        <div class="tab-pane active">
            <!-- Class List Header -->
            <div class="classlist-header">
                <div class="header-actions">
                    <h2><i class="fas fa-users"></i> Class List</h2>
                </div>
                <div class="view-selector">
                    <label for="viewDropdown">View:</label>
                    <select id="viewDropdown" class="view-dropdown">
                        <option value="student-info">Student Information</option>
                        <option value="attendance">Take Attendance</option>
                        <option value="performance">Performance Overview</option>
                    </select>
                </div>
            </div>

            <!-- Student Information View -->
            <div id="studentInfoView" class="view-container active-view">
                <div class="classlist-container">
                    <div class="table-responsive">
                        <table class="classlist-table">
                            <thead>
                                <tr>
                                    <th>Student ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                </tr>
                            </thead>
                            <tbody id="studentTableBody">
                                <tr>
                                    <td colspan="5" class="loading-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p style="margin-top: 1rem;">Loading students...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Take Attendance View -->
            <div id="attendanceView" class="view-container">
                <div class="classlist-container">
                    <div class="date-selector">
                        <label for="attendanceDate">Date:</label>
                        <input type="date" id="attendanceDate" class="form-control" value="@defaultAttendanceDate">
                    </div>
                    <div class="attendance-info">
                        <div class="attendance-summary">
                            <span class="summary-item"><strong>Total Students:</strong> <span id="totalStudents">0</span></span>
                            <span class="summary-item"><strong>Present:</strong> <span id="presentCount">0</span></span>
                            <span class="summary-item"><strong>Late:</strong> <span id="lateCount">0</span></span>
                            <span class="summary-item"><strong>Absent:</strong> <span id="absentCount">0</span></span>
                            <span class="summary-item"><strong>Unmarked:</strong> <span id="unmarkedCount">0</span></span>
                        </div>
                        <div class="attendance-actions">
                            <button class="export-attendance"><i class="fas fa-save"></i>Export to CSV</button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="classlist-table">
                            <thead>
                                <tr>
                                    <th>No.</th>
                                    <th>Student Number</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Attendance Status</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <tr>
                                    <td colspan="5" class="loading-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p style="margin-top: 1rem;">Preparing attendance list...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="performanceView" class="view-container">
                <div class="classlist-container">
                    <div class="performance-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 0.5rem 0;">
                            <button id="addManualClassworkBtn" class="btn btn-secondary" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px;">
                                <i class="fas fa-plus"></i> Add Classwork
                            </button>
                            <button id="exportPerformanceBtn" class="btn btn-success" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px;">
                                <i class="fas fa-file-csv"></i> Export to CSV
                            </button>
                    </div>
                    <div class="table-responsive">
                        <table class="classlist-table performance-table">
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <!-- Dynamic headers will be loaded by JavaScript -->
                                </tr>
                            </thead>
                            <tbody id="performanceTableBody">
                                <tr>
                                    <td class="loading-state">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p style="margin-top: 1rem;">Loading performance data...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Manual Classwork Addition Modal -->
<div id="addClassworkModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3><i class="fas fa-plus"></i> Add Classwork</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <form id="addClassworkForm">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="classworkTitle" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Title:</label>
                    <input type="text" id="classworkTitle" class="form-control" placeholder="Enter classwork title" required
                           style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="classworkTypeSelect" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Type:</label>
                    <select id="classworkTypeSelect" class="form-control" required
                            style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">Select type</option>
                        <option value="Assignment">Assignment</option>
                        <option value="Quiz">Quiz</option>
                        <option value="Exam">Exam</option>
                        <option value="Project">Project</option>
                        <option value="Activity">Activity</option>
                        <option value="Homework">Homework</option>
                    </select>
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="classworkPoints" style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Points:</label>
                    <input type="number" id="classworkPoints" class="form-control" placeholder="Total points" min="1" max="1000" required
                           style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" id="addClassworkCancel">Cancel</button>
            <button class="btn-confirm" id="addClassworkSave" disabled>
                <i class="fas fa-plus"></i> Add Classwork
            </button>
        </div>
    </div>
</div>

<!-- Late Minutes Modal -->
<div id="lateModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Mark Student as Late</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <p>How many minutes late is <strong id="lateStudentName"></strong>?</p>
            <div class="input-group">
                <input type="number" id="lateMinutesInput" class="form-control" min="0" placeholder="Enter minutes" />
                <span class="input-suffix">minutes</span>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel">Cancel</button>
            <button class="btn-confirm">Confirm</button>
        </div>
    </div>
</div>

<!-- Export Confirmation Modal -->
<div id="exportModal" class="modal">
    <div class="modal-content modal-export">
        <div class="modal-header">
            <h3><i class="fas fa-file-download"></i> Export Attendance</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <p style="margin: 0; font-size: 1rem; color: var(--dark-primary-color);">
                Are you sure you want to download attendance record on <strong id="exportDate" style="color: var(--primary-color);"></strong>?
            </p>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" id="exportCancel">Cancel</button>
            <button class="btn-confirm" id="exportConfirm">
                <i class="fas fa-download"></i> Download CSV
            </button>
        </div>
    </div>
</div>

@section scripts {
    @Html.AntiForgeryToken()
    <script>
        var teacherCourseSectionId = @ViewBag.TeacherCourseSectionId;
        var courseId = @courseId;
    </script>
    <script src="~/Scripts/Custom/classlist.js"></script>
}