@model LMS.Models.Course

@{
    ViewBag.Title = "Take Quiz";
    int courseId = ViewBag.CourseId ?? Model.Id;
    var classwork = ViewBag.Classwork as dynamic;
    string questionsJson = ViewBag.QuestionsJson as string ?? "[]";
}

<link rel="stylesheet" href="~/Content/teacherCourse.css" />
<link rel="stylesheet" href="~/Content/teacherViewCourse.css" />

<style>
    /* All your existing CSS - keep it exactly as is */
    .quiz-container {
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
    }

    .quiz-header {
        background: white;
        border-bottom: 2px solid #e0e0e0;
        padding: 20px 30px;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .quiz-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
        margin: 0 0 10px 0;
    }

    .quiz-meta {
        display: flex;
        gap: 30px;
        color: #666;
        font-size: 0.9rem;
    }

    .quiz-meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .quiz-body {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 20px;
        padding: 30px;
        min-height: calc(100vh - 200px);
    }

    .quiz-content {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .question-container {
        display: none;
    }

        .question-container.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateX(20px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .question-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }

    .question-number {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--primary-color);
    }

    .question-points {
        background: #f0f0f0;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .question-text {
        font-size: 1.1rem;
        line-height: 1.6;
        color: #333;
        margin-bottom: 25px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
    }

    .answer-options {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .answer-option {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        background: white;
    }

        .answer-option:hover {
            border-color: var(--primary-color);
            background: #f8f9ff;
        }

        .answer-option input[type="radio"],
        .answer-option input[type="checkbox"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .answer-option.selected {
            border-color: var(--primary-color);
            background: #f0f4ff;
        }

    .answer-text-input {
        width: 100%;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        font-family: inherit;
        resize: vertical;
        min-height: 100px;
    }

        .answer-text-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

    .quiz-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid #f0f0f0;
    }

    .btn-nav {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-previous {
        background: #f0f0f0;
        color: #666;
    }

        .btn-previous:hover:not(:disabled) {
            background: #e0e0e0;
        }

    .btn-next {
        background: var(--primary-color);
        color: white;
    }

        .btn-next:hover:not(:disabled) {
            background: var(--dark-primary-color);
        }

    .btn-nav:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .quiz-sidebar {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        position: sticky;
        top: 120px;
        height: fit-content;
    }

    .sidebar-header {
        font-weight: 600;
        margin-bottom: 15px;
        color: #333;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .question-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        margin-bottom: 20px;
    }

    .question-dot {
        aspect-ratio: 1;
        border-radius: 50%;
        border: 2px solid #e0e0e0;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.85rem;
        font-weight: 600;
        color: #999;
    }

        .question-dot:hover {
            border-color: var(--primary-color);
            transform: scale(1.1);
        }

        .question-dot.answered {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .question-dot.current {
            border-color: var(--primary-color);
            border-width: 3px;
            box-shadow: 0 0 0 3px rgba(24, 82, 172, 0.1);
        }

    .legend {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e0e0e0;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.85rem;
        color: #666;
    }

    .legend-dot {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid #e0e0e0;
    }

        .legend-dot.answered {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

    .submit-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
    }

    .btn-submit-quiz {
        width: 100%;
        padding: 15px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

        .btn-submit-quiz:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

    .progress-info {
        text-align: center;
        margin-bottom: 15px;
        color: #666;
    }

    .progress-bar-container {
        height: 8px;
        background: #f0f0f0;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 10px;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-color), var(--dark-primary-color));
        transition: width 0.3s ease;
    }

    .tf-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .tf-option {
        padding: 20px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        transition: all 0.2s;
        background: white;
    }

        .tf-option:hover {
            border-color: var(--primary-color);
            background: #f8f9ff;
        }

        .tf-option input[type="radio"] {
            display: none;
        }

        .tf-option.selected {
            border-color: var(--primary-color);
            background: #f0f4ff;
        }

    .tf-label {
        font-weight: 600;
        font-size: 1.1rem;
    }

    .no-copy {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .file-upload-area {
        margin-top: 10px;
    }

    .file-upload-input {
        display: none;
    }

    @@media (max-width: 992px) {
        .quiz-body {
            grid-template-columns: 1fr;
            padding: 20px;
        }

        .quiz-sidebar {
            position: relative;
            top: auto;
            margin-top: 20px;
            width: 100%;
        }

        .question-grid {
            gap: 6px;
        }

        .quiz-content {
            padding: 20px;
        }

        .quiz-header {
            padding: 15px 20px;
        }

        .quiz-title {
            font-size: 1.3rem;
        }

        .quiz-meta {
            flex-direction: column;
            gap: 10px;
        }

        .btn-nav {
            width: 48%;
            justify-content: center;
            padding: 10px;
        }

        .tf-options {
            grid-template-columns: 1fr;
        }

        .answer-options .answer-option {
            padding: 12px 15px;
            font-size: 0.95rem;
        }

        .answer-text-input {
            font-size: 0.95rem;
            padding: 12px;
        }

        .submit-section .btn-submit-quiz {
            padding: 12px;
            font-size: 0.95rem;
        }
    }

    @@media (max-width: 576px) {
        .quiz-title {
            font-size: 1.1rem;
        }

        .quiz-meta-item span {
            font-size: 0.8rem;
        }

        .question-number {
            font-size: 1rem;
        }

        .question-points {
            font-size: 0.75rem;
            padding: 4px 10px;
        }

        .quiz-navigation .btn-nav {
            width: 100%;
            margin-bottom: 10px;
        }

        .quiz-navigation {
            flex-direction: column;
            gap: 10px;
        }

        .tf-options .tf-option {
            padding: 15px;
            font-size: 0.95rem;
        }

        .file-upload-area button.btn-next {
            font-size: 0.9rem;
            padding: 10px;
        }

        .file-upload-area p {
            font-size: 0.85rem;
        }
    }
</style>

<div class="quiz-container no-copy">
    <div class="quiz-header">
        <h1 class="quiz-title">@classwork.Title</h1>
        <div class="quiz-meta">
            <div class="quiz-meta-item">
                <i class="fas fa-clipboard-question"></i>
                <span id="questionCount">Loading...</span>
            </div>
            <div class="quiz-meta-item">
                <i class="fas fa-star"></i>
                <span>@classwork.Points Points</span>
            </div>
            <div class="quiz-meta-item">
                <i class="fas fa-clock"></i>
                <span id="timerDisplay">Time Remaining: Calculating...</span>
            </div>
        </div>
    </div>

    <div class="quiz-body">
        <div class="quiz-content">
            <form id="quizForm">
                @Html.AntiForgeryToken()
                <div id="questionsContainer"></div>
            </form>
        </div>

        <div class="quiz-sidebar">
            <div class="sidebar-header">
                <i class="fas fa-th"></i>
                Questions
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="progress-info" id="progressInfo">0 of 0 answered</div>

            <div class="question-grid" id="questionGrid"></div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot answered"></div>
                    <span>Answered</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot"></div>
                    <span>Not Answered</span>
                </div>
            </div>

            <div class="submit-section">
                <button type="button" class="btn-submit-quiz" onclick="submitQuiz()">
                    <i class="fas fa-check"></i>
                    Submit Quiz
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // ✅ Parse JSON on client side to avoid server-side serialization issues
    const questionsData = @Html.Raw(questionsJson);
    let currentQuestion = 0;
    const totalQuestions = questionsData.length;
    const answeredQuestions = new Set();
    const deadline = new Date('@(classwork.Deadline?.ToString("yyyy-MM-ddTHH:mm:ss") ?? "")');

    // Initialize quiz
    document.addEventListener('DOMContentLoaded', function() {
        renderQuiz();
    });

    function renderQuiz() {
        const container = document.getElementById('questionsContainer');
        const grid = document.getElementById('questionGrid');

        document.getElementById('questionCount').textContent = `${totalQuestions} Questions`;
        document.getElementById('progressInfo').textContent = `0 of ${totalQuestions} answered`;

        questionsData.forEach((question, i) => {
            // Render question container
            const questionHtml = renderQuestion(question, i);
            container.innerHTML += questionHtml;

            // Render grid dot
            grid.innerHTML += `
                <button type="button"
                        class="question-dot ${i === 0 ? 'current' : ''}"
                        data-question="${i}"
                        onclick="navigateQuestion(${i})">
                    ${i + 1}
                </button>
            `;
        });
    }

    function renderQuestion(question, index) {
        const isActive = index === 0 ? 'active' : '';
        const questionType = question.type || '';
        const questionText = question.questionText || '';
        const points = question.points || 0;

        let optionsHtml = '';

        if (questionType === 'multipleChoice') {
            optionsHtml = '<div class="answer-options">';
            (question.options || []).forEach((opt, j) => {
                optionsHtml += `
                    <label class="answer-option" onclick="selectOption(this, ${index}, ${j}, 'radio')">
                        <input type="radio" name="answer_${index}" value="${j}" />
                        <span>${opt.text || ''}</span>
                    </label>
                `;
            });
            optionsHtml += '</div>';
        } else if (questionType === 'multipleAnswer') {
            optionsHtml = '<div class="answer-options">';
            (question.options || []).forEach((opt, j) => {
                optionsHtml += `
                    <label class="answer-option" onclick="selectOption(this, ${index}, ${j}, 'checkbox')">
                        <input type="checkbox" name="answer_${index}[]" value="${j}" />
                        <span>${opt.text || ''}</span>
                    </label>
                `;
            });
            optionsHtml += '</div>';
        } else if (questionType === 'trueFalse') {
            optionsHtml = `
                <div class="tf-options">
                    <div class="tf-option" onclick="selectTrueFalse(this, ${index}, true)">
                        <input type="radio" name="answer_${index}" value="true" />
                        <div class="tf-label">
                            <i class="fas fa-check" style="color: #4CAF50;"></i> True
                        </div>
                    </div>
                    <div class="tf-option" onclick="selectTrueFalse(this, ${index}, false)">
                        <input type="radio" name="answer_${index}" value="false" />
                        <div class="tf-label">
                            <i class="fas fa-times" style="color: #f44336;"></i> False
                        </div>
                    </div>
                </div>
            `;
        } else if (questionType === 'identification') {
            optionsHtml = `
                <input type="text"
                       class="answer-text-input"
                       name="answer_${index}"
                       placeholder="Type your answer here..."
                       onpaste="return false"
                       oncut="return false"
                       oncopy="return false"
                       oncontextmenu="return false"
                       onkeyup="markAsAnswered(${index})" />
            `;
        } else if (questionType === 'essay') {
            const maxWords = question.maxWords || '';
            optionsHtml = `
                <textarea class="answer-text-input"
                          name="answer_${index}"
                          rows="8"
                          placeholder="Type your essay here..."
                          onpaste="return false"
                          oncut="return false"
                          oncopy="return false"
                          oncontextmenu="return false"
                          onkeyup="markAsAnswered(${index})"
                          ${maxWords ? `maxlength="${maxWords}"` : ''}></textarea>
                ${maxWords ? `<small style="color: #666; margin-top: 5px; display: block;">Maximum ${maxWords} words</small>` : ''}
            `;
        } else if (questionType === 'fileUpload') {
            const allowedTypes = question.allowedFileTypes || '.pdf,.doc,.docx';
            const maxSize = question.maxFileSize || '';
            optionsHtml = `
                <div class="file-upload-area">
                    <div style="padding: 20px; background: #f8f9fa; border: 2px dashed #e0e0e0; border-radius: 8px; text-align: center;">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #999; margin-bottom: 15px;"></i>
                        <p style="color: #666; margin-bottom: 15px;">Click or drag file to upload</p>
                        <input type="file"
                               id="fileUpload_${index}"
                               name="answer_${index}_file"
                               class="file-upload-input"
                               accept="${allowedTypes}"
                               onchange="handleFileUpload(${index}, this)"
                               style="display: none;" />
                        <button type="button"
                                class="btn-nav btn-next"
                                onclick="document.getElementById('fileUpload_${index}').click()"
                                style="display: inline-flex;">
                            <i class="fas fa-file-upload"></i>
                            Choose File
                        </button>
                        <div id="fileInfo_${index}" style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px; display: none;">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-file" style="color: var(--primary-color);"></i>
                                    <span id="fileName_${index}" style="font-weight: 500;"></span>
                                </div>
                                <button type="button"
                                        class="btn-previous"
                                        onclick="clearFileUpload(${index})"
                                        style="padding: 8px 12px;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <small style="color: #999; display: block; margin-top: 10px;">
                            Allowed types: ${allowedTypes}
                            ${maxSize ? ` • Max size: ${maxSize} MB` : ''}
                        </small>
                    </div>
                </div>
            `;
        }

        const prevDisabled = index === 0 ? 'disabled' : '';
        const nextBtn = index < totalQuestions - 1
            ? `<button type="button" class="btn-nav btn-next" onclick="navigateQuestion(${index + 1})">
                   Next
                   <i class="fas fa-chevron-right"></i>
               </button>`
            : '';

        return `
            <div class="question-container ${isActive}" data-question-index="${index}">
                <div class="question-header">
                    <span class="question-number">Question ${index + 1} of ${totalQuestions}</span>
                    <span class="question-points">${points} pt${points > 1 ? 's' : ''}</span>
                </div>
                <div class="question-text">${questionText}</div>
                ${optionsHtml}
                <div class="quiz-navigation">
                    <button type="button"
                            class="btn-nav btn-previous"
                            onclick="navigateQuestion(${index - 1})"
                            ${prevDisabled}>
                        <i class="fas fa-chevron-left"></i>
                        Previous
                    </button>
                    ${nextBtn}
                </div>
            </div>
        `;
    }

    // Disable copy-paste globally
    document.addEventListener('copy', function(e) {
        e.preventDefault();
        return false;
    });

    document.addEventListener('cut', function(e) {
        e.preventDefault();
        return false;
    });

    document.addEventListener('paste', function(e) {
        e.preventDefault();
        return false;
    });

    document.addEventListener('contextmenu', function(e) {
        if (e.target.closest('.quiz-container')) {
            e.preventDefault();
            return false;
        }
    });

    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && (e.key === 'c' || e.key === 'v' || e.key === 'x' || e.key === 'a')) {
            if (e.target.closest('.quiz-container')) {
                e.preventDefault();
                return false;
            }
        }
    });

    function navigateQuestion(index) {
        if (index < 0 || index >= totalQuestions) return;

        document.querySelectorAll('.question-container').forEach(q => q.classList.remove('active'));
        document.querySelectorAll('.question-dot').forEach(d => d.classList.remove('current'));

        document.querySelector(`[data-question-index="${index}"]`).classList.add('active');
        document.querySelector(`[data-question="${index}"]`).classList.add('current');

        currentQuestion = index;
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function selectOption(element, questionIndex, optionIndex, type) {
        const input = element.querySelector('input');

        if (type === 'radio') {
            const container = element.closest('.answer-options');
            container.querySelectorAll('.answer-option').forEach(opt => opt.classList.remove('selected'));

            input.checked = true;
            element.classList.add('selected');
        } else {
            input.checked = !input.checked;
            element.classList.toggle('selected', input.checked);
        }

        markAsAnswered(questionIndex);
    }

    function selectTrueFalse(element, questionIndex, value) {
        const container = element.closest('.tf-options');
        container.querySelectorAll('.tf-option').forEach(opt => opt.classList.remove('selected'));

        const input = element.querySelector('input');
        input.checked = true;
        element.classList.add('selected');

        markAsAnswered(questionIndex);
    }

    function markAsAnswered(questionIndex) {
        answeredQuestions.add(questionIndex);
        updateProgress();

        const dot = document.querySelector(`[data-question="${questionIndex}"]`);
        if (dot) {
            dot.classList.add('answered');
        }
    }

    function handleFileUpload(questionIndex, input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            const fileInfo = document.getElementById(`fileInfo_${questionIndex}`);
            const fileName = document.getElementById(`fileName_${questionIndex}`);

            fileName.textContent = file.name;
            fileInfo.style.display = 'block';

            markAsAnswered(questionIndex);
        }
    }

    function clearFileUpload(questionIndex) {
        const input = document.getElementById(`fileUpload_${questionIndex}`);
        const fileInfo = document.getElementById(`fileInfo_${questionIndex}`);

        input.value = '';
        fileInfo.style.display = 'none';

        answeredQuestions.delete(questionIndex);
        updateProgress();

        const dot = document.querySelector(`[data-question="${questionIndex}"]`);
        if (dot) {
            dot.classList.remove('answered');
        }
    }

    function updateProgress() {
        const answered = answeredQuestions.size;
        const percentage = (answered / totalQuestions) * 100;

        document.getElementById('progressBar').style.width = percentage + '%';
        document.getElementById('progressInfo').textContent = `${answered} of ${totalQuestions} answered`;
    }

    function submitQuiz() {
        const unanswered = totalQuestions - answeredQuestions.size;

        if (unanswered > 0) {
            if (!confirm(`You have ${unanswered} unanswered question(s). Do you want to submit anyway?`)) {
                return;
            }
        }

        if (!confirm('Are you sure you want to submit your quiz? You cannot change your answers after submission.')) {
            return;
        }

        const answers = [];

        for (let i = 0; i < totalQuestions; i++) {
            let answerValue = null;

            const checkboxes = document.querySelectorAll(`input[name="answer_${i}[]"]:checked`);
            if (checkboxes.length > 0) {
                answerValue = Array.from(checkboxes).map(cb => parseInt(cb.value));
            } else {
                const radioInput = document.querySelector(`input[name="answer_${i}"]:checked`);
                const textInput = document.querySelector(`input[name="answer_${i}"]`);
                const textareaInput = document.querySelector(`textarea[name="answer_${i}"]`);

                if (radioInput) {
                    answerValue = radioInput.value;
                } else if (textareaInput) {
                    answerValue = textareaInput.value;
                } else if (textInput && textInput.type !== 'radio') {
                    answerValue = textInput.value;
                }
            }

            answers.push({
                answer: answerValue
            });
        }

        const formData = new FormData();
        formData.append('answersJson', JSON.stringify(answers));
        formData.append('classworkId', @classwork.Id);
        formData.append('courseId', @courseId);

        for (let i = 0; i < totalQuestions; i++) {
            const fileInput = document.getElementById(`fileUpload_${i}`);
            if (fileInput && fileInput.files.length > 0) {
                formData.append(`question_${i}_file`, fileInput.files[0]);
            }
        }

        const tokenInput = document.querySelector('input[name="__RequestVerificationToken"]');
        if (tokenInput) {
            formData.append('__RequestVerificationToken', tokenInput.value);
        }

        const submitBtn = document.querySelector('.btn-submit-quiz');
        const originalText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';

        $.ajax({
            url: '@Url.Action("SubmitQuizAnswers", "Student")',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if (response.success) {
                    alert('Quiz submitted successfully!');
                    window.location.href = '@Url.Action("ViewClasswork", "Student", new { id = courseId, classworkId = classwork.Id })';
                } else {
                    alert('Error: ' + response.message);
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                }
            },
            error: function(xhr, status, error) {
                console.error('Submit error:', error);
                console.error('Response:', xhr.responseText);
                alert('An error occurred while submitting your quiz. Please try again.');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });
    }

    function updateTimer() {
        const now = new Date();
        const diff = deadline - now;

        if (diff <= 0) {
            document.getElementById('timerDisplay').textContent = 'Time is up!';
            alert('Time is up! Your quiz will be submitted automatically.');
            submitQuiz();
            return;
        }

        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        document.getElementById('timerDisplay').textContent =
            `Time Remaining: ${hours}h ${minutes}m ${seconds}s`;
    }

    @if (classwork.Deadline != null)
    {
        <text>
        setInterval(updateTimer, 1000);
        updateTimer();
        </text>
    }
    else
    {
        <text>
        document.getElementById('timerDisplay').textContent = 'No time limit';
        </text>
    }

    window.addEventListener('beforeunload', function (e) {
        if (answeredQuestions.size > 0) {
            e.preventDefault();
            e.returnValue = '';
            return '';
        }
    });
</script>